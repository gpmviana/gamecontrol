<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Game Control v1.2</title>
<style>
:root{
  --bg-dark:#2c2c2c;
  --bg-light:#f4f4f4;
  --text-dark:#fff;
  --text-light:#111;
  --green:#4caf50;
  --red:#e74c3c;
  --gray:#999;
}
body{
  font-family:Arial, sans-serif;
  background-color:var(--bg-dark);
  color:var(--text-dark);
  margin:0;
  display:flex;
  flex-direction:column;
  align-items:center;
}
body.light-mode{background:var(--bg-light);color:var(--text-light);}
header{
  background:#3b3b3b;
  color:#fff;
  width:100%;
  text-align:center;
  padding:15px 0 10px;
  font-size:22px;
  font-weight:bold;
  position:relative;
}
body.light-mode header{background:#ddd;color:#000;}
#fullscreenBtn{
  position:absolute;
  right:15px;
  top:12px;
  background:none;
  border:none;
  color:#fff;
  font-size:20px;
  cursor:pointer;
}
body.light-mode #fullscreenBtn{color:#000;}
.team-names{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  margin-top:8px;
}
.team-names input{
  background:#222;
  color:#fff;
  border:1px solid #555;
  border-radius:6px;
  padding:5px 10px;
  font-size:16px;
  width:160px;
  text-align:center;
}
body.light-mode .team-names input{background:#fff;color:#000;border:1px solid #aaa;}
.team-names span{font-weight:bold;color:#ccc;}

.timer{
  font-size:70px;
  margin:15px 0;
  font-weight:bold;
}
.controls{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:10px;
  margin-bottom:20px;
}
.controls button{
  padding:10px 16px;
  font-size:15px;
  border:none;
  border-radius:6px;
  background:#555;
  color:#fff;
  cursor:pointer;
}
.controls button:hover{background:#666;}
body.light-mode .controls button{background:#ccc;color:#000;}

.players{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:12px;
  margin:10px 20px;
  width:90%;
}
.player{
  border-radius:14px;
  padding:15px;
  text-align:center;
  color:#fff;
  cursor:pointer;
  transition:transform .2s ease;
}
.player:hover{transform:scale(1.04);}
.player.active{background:var(--green);}
.player.inactive{background:var(--red);}
.player strong{display:block;font-size:17px;margin-bottom:8px;}
.player .time{font-size:32px;font-weight:bold;}
.player .last{font-size:13px;color:var(--gray);margin-top:3px;}

.summary{
  width:90%;
  background:#3b3b3b;
  color:#fff;
  border-radius:10px;
  padding:10px;
  margin-bottom:40px;
}
body.light-mode .summary{background:#eee;color:#000;}
.summary table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
  text-align:center;
}
.summary th,.summary td{
  border:1px solid #666;
  padding:6px;
}
.work-pos{color:var(--green);font-weight:bold;}
.work-neg{color:var(--red);font-weight:bold;}
</style>
</head>
<body>
<header>
  Game Control
  <button id="fullscreenBtn">â›¶</button>
  <div class="team-names">
    <input id="teamA" placeholder="Equipa" />
    <span>vs</span>
    <input id="opponent" placeholder="AdversÃ¡rio" />
  </div>
</header>

<div class="timer" id="timer">20:00</div>
<div class="controls">
  <input type="number" id="setMinutes" value="20" min="1" style="width:60px;"> min
  <button id="startBtn">Iniciar</button>
  <button id="pauseBtn">Pausar</button>
  <button id="intervalBtn">Intervalo</button>
  <button id="resetBtn">Reset</button>
  <button id="printBtn">ðŸ“¸</button>
  <button id="themeToggle">ðŸŒ™</button>
  <button id="addBtn">âž•</button>
  <button id="removeBtn">âž–</button>
</div>

<div class="players" id="players"></div>

<div class="summary">
  <h3 style="text-align:center;">Resumo do Jogo</h3>
  <table>
    <thead>
      <tr>
        <th>Jogador</th>
        <th>Tempo Campo</th>
        <th>Tempo Banco</th>
        <th>RotaÃ§Ãµes</th>
        <th>MÃ©dia RotaÃ§Ã£o</th>
        <th>% Jogo</th>
        <th>Workload</th>
      </tr>
    </thead>
    <tbody id="summaryBody"></tbody>
  </table>
</div>
<script>
let duration = 20 * 60;
let remaining = duration;
let timerInterval;
let running = false;
let half = 1;
let players = [];

function formatTime(sec){
  const sign = sec<0?'-':'';
  const s = Math.abs(sec);
  const m = Math.floor(s/60);
  const r = s%60;
  return sign+String(m).padStart(2,'0')+':'+String(r).padStart(2,'0');
}

function updateTimer(){
  document.getElementById('timer').textContent = formatTime(remaining);
}

function tick(){
  remaining--;
  updateTimer();
  players.forEach(p=>{
    if(p.active) p.seconds++;
    else p.bench++;
    p.timeDisplay.textContent = formatTime(p.active?p.seconds:p.bench);
  });
  updateSummary();
}

function startTimer(){
  if(running) return;
  running = true;
  timerInterval=setInterval(tick,1000);
}
function pauseTimer(){running=false;clearInterval(timerInterval);}
function resetTimer(){
  pauseTimer();
  const mins=parseInt(document.getElementById('setMinutes').value)||20;
  duration=mins*60;remaining=duration;
  players.forEach(p=>{p.seconds=0;p.bench=0;p.rot=0;p.active=false;});
  updateTimer();
  updateSummary();
  saveData();
}

function intervalTimer(){
  pauseTimer();
  remaining=parseInt(document.getElementById('setMinutes').value||20)*60;
  half=2;updateTimer();
}

function togglePlayer(i){
  const p=players[i];
  if(p.editing) return;
  p.active=!p.active;
  if(p.active){p.rot++;p.div.classList.add('active');p.div.classList.remove('inactive');}
  else{
    p.div.classList.remove('active');p.div.classList.add('inactive');
    p.lastDisplay.textContent='Ãšltima: '+formatTime(p.seconds);
  }
  saveData();
}

function createPlayers(n=14){
  const c=document.getElementById('players');c.innerHTML='';
  players=[];
  for(let i=0;i<n;i++){
    const d=document.createElement('div');
    d.className='player inactive';
    const s=document.createElement('strong');
    s.textContent='Jogador '+(i+1);
    const t=document.createElement('div');
    t.className='time';t.textContent='00:00';
    const l=document.createElement('div');
    l.className='last';
    d.append(s,t,l);
    c.appendChild(d);
    const p={id:i,name:s.textContent,active:false,seconds:0,bench:0,rot:0,div:d,timeDisplay:t,lastDisplay:l,editing:false};
    d.onclick=()=>togglePlayer(i);
    players.push(p);
  }
}

function updateSummary(){
  const tb=document.getElementById('summaryBody');tb.innerHTML='';
  const total=(half===1?duration:duration*2);
  players.forEach(p=>{
    const perc=((p.seconds/total)*100).toFixed(1)+'%';
    const med=p.rot>0?formatTime(Math.floor(p.seconds/p.rot)):'-';
    const workload=(p.seconds-p.bench);
    const workClass=workload>=0?'work-pos':'work-neg';
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${p.name}</td>
      <td>${formatTime(p.seconds)}</td>
      <td>${formatTime(p.bench)}</td>
      <td>${p.rot}</td>
      <td>${med}</td>
      <td>${perc}</td>
      <td class="${workClass}">${workload>=0?'+':''}${workload}</td>`;
    tb.appendChild(tr);
  });
  saveData();
}

function saveData(){
  const data={players:players.map(p=>({n:p.name,a:p.active,s:p.seconds,b:p.bench,r:p.rot})),
              teamA:teamA.value,opponent:opponent.value,half,remaining};
  localStorage.setItem('gamecontrol_v1.2',JSON.stringify(data));
}

function loadData(){
  const d=localStorage.getItem('gamecontrol_v1.2');
  if(!d)return;
  const data=JSON.parse(d);
  teamA.value=data.teamA||'';opponent.value=data.opponent||'';
  half=data.half||1;remaining=data.remaining||duration;
  createPlayers(data.players.length);
  data.players.forEach((p,i)=>{
    const pl=players[i];
    pl.name=p.n;pl.seconds=p.s;pl.bench=p.b;pl.rot=p.r;pl.active=p.a;
    pl.div.querySelector('strong').textContent=pl.name;
    pl.div.classList.toggle('active',pl.active);
    pl.div.classList.toggle('inactive',!pl.active);
  });
  updateTimer();
  updateSummary();
}

function printTable(){
  const w=window.open('','PRINT','height=800,width=1000');
  const teamAName=document.getElementById('teamA').value||'Equipa';
  const opponentName=document.getElementById('opponent').value||'AdversÃ¡rio';
  const table=document.querySelector('.summary').innerHTML;
  w.document.write(`<html><head><title>${teamAName} vs ${opponentName}</title>
  <style>body{font-family:Arial;background:#fff;color:#000;text-align:center;}
  table{width:100%;border-collapse:collapse;}th,td{border:1px solid #999;padding:6px;}
  </style></head><body><h2>${teamAName} vs ${opponentName}</h2>${table}</body></html>`);
  w.document.close();w.focus();w.print();w.close();
}

document.getElementById('startBtn').onclick=startTimer;
document.getElementById('pauseBtn').onclick=pauseTimer;
document.getElementById('resetBtn').onclick=resetTimer;
document.getElementById('intervalBtn').onclick=intervalTimer;
document.getElementById('printBtn').onclick=printTable;
document.getElementById('addBtn').onclick=()=>{createPlayers(players.length+1);saveData();};
document.getElementById('removeBtn').onclick=()=>{if(players.length>1){createPlayers(players.length-1);saveData();}};
document.getElementById('themeToggle').onclick=()=>{
  document.body.classList.toggle('light-mode');
  localStorage.setItem('theme',document.body.classList.contains('light-mode')?'light':'dark');
};
document.getElementById('fullscreenBtn').onclick=()=>{
  if(!document.fullscreenElement)document.documentElement.requestFullscreen();
  else document.exitFullscreen();
};
document.getElementById('teamA').oninput=saveData;
document.getElementById('opponent').oninput=saveData;

createPlayers();
updateTimer();
loadData();
if(localStorage.getItem('theme')==='light')document.body.classList.add('light-mode');
setInterval(()=>{if(running)saveData();},5000);
</script>
</body>
</html>
