<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game Control</title>
<style>
  :root {
    --bg-dark: #2c2c2c;
    --bg-light: #f7f7f7;
    --text-dark: #000;
    --text-light: #fff;
    --primary-green: #4caf50;
    --primary-red: #e74c3c;
    --primary-blue: #3498db;
    --neutral-gray: #ccc;
  }

  body {
    margin: 0;
    font-family: "Segoe UI", Arial, sans-serif;
    background-color: var(--bg-dark);
    color: var(--text-light);
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: background-color 0.5s, color 0.5s;
  }

  header {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #444;
    padding: 10px 20px;
    color: #fff;
  }

  .team-input {
    background: transparent;
    border: none;
    border-bottom: 1px solid #aaa;
    color: inherit;
    font-size: 18px;
    width: 180px;
    text-align: center;
    outline: none;
  }

  .title {
    font-size: 24px;
    font-weight: bold;
  }

  .actions {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .actions button {
    background: none;
    border: none;
    color: inherit;
    cursor: pointer;
    font-size: 20px;
    transition: transform 0.2s;
  }

  .actions button:hover {
    transform: scale(1.2);
  }

  .timer {
    font-size: 64px;
    margin: 10px 0;
  }

  .controls {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
  }

  .controls button {
    padding: 10px 20px;
    font-size: 16px;
    background: #555;
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.2s;
  }

  .controls button:hover {
    background: #777;
  }

  .players {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    max-width: 1200px;
  }

  .player {
    width: 230px;
    height: 150px;
    background: #3a3a3a;
    border-radius: 12px;
    color: white;
    text-align: center;
    padding: 10px;
    box-sizing: border-box;
    cursor: pointer;
    transition: background 0.3s, transform 0.2s;
  }

  .player.active {
    background: #2e7d32;
  }

  .player.inactive {
    background: #8b1a1a;
  }

  .player:hover {
    transform: scale(1.03);
  }

  .player strong {
    display: block;
    margin-bottom: 5px;
    font-size: 18px;
  }

  .player .time {
    font-size: 32px;
    font-weight: bold;
  }

  .player .last {
    font-size: 14px;
    color: #9ae59a;
    margin-top: 6px;
  }

  .summary {
    width: 90%;
    max-width: 1100px;
    margin-top: 30px;
    overflow-x: auto;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    text-align: center;
    font-size: 15px;
    background: inherit;
  }

  thead {
    position: sticky;
    top: 0;
    background: #555;
    color: white;
    z-index: 2;
  }

  th, td {
    border: 1px solid #777;
    padding: 8px;
  }

  tbody tr:nth-child(even) {
    background: rgba(255, 255, 255, 0.05);
  }

  .work-pos {
    color: #4caf50;
    font-weight: bold;
  }

  .work-neg {
    color: #e74c3c;
    font-weight: bold;
  }

  .light-mode {
    background-color: var(--bg-light);
    color: var(--text-dark);
  }

  .light-mode header {
    background: #ddd;
    color: #000;
  }

  .light-mode .player {
    background: #f2f2f2;
    color: #000;
  }

  .light-mode .player.active {
    background: #a8e6a3;
  }

  .light-mode .player.inactive {
    background: #e9a3a3;
  }

  .light-mode thead {
    background: #bbb;
    color: #000;
  }

</style>
</head>
<body>
  <header>
    <input type="text" id="teamA" class="team-input" placeholder="Equipa A">
    <div class="title">Game Control</div>
    <div class="actions">
      <button id="printBtn">ðŸ“¸</button>
      <button id="fullscreenBtn">â›¶</button>
      <button id="themeToggle">ðŸŒ™</button>
    </div>
  </header>

  <div class="timer" id="timer">20:00</div>

  <div class="controls">
    <input type="number" id="setMinutes" value="20" min="1" style="width:60px;"> min
    <button id="startBtn">Iniciar</button>
    <button id="pauseBtn">Pausar</button>
    <button id="intervalBtn">Intervalo</button>
    <button id="resetBtn">Reset</button>
    <button id="addBtn">âž• Jogador</button>
    <button id="removeBtn">âž– Jogador</button>
  </div>

  <div class="players" id="players"></div>

  <div class="summary">
    <h3 style="text-align:center;">Resumo de Jogo</h3>
    <table>
      <thead>
        <tr>
          <th>Jogador</th>
          <th>Tempo em Campo</th>
          <th>Tempo Fora</th>
          <th>RotaÃ§Ãµes</th>
          <th>MÃ©dia RotaÃ§Ã£o</th>
          <th>% Jogo</th>
          <th>Workload</th>
        </tr>
      </thead>
      <tbody id="summaryBody"></tbody>
    </table>
  </div>

<script>
let duration = 20 * 60;
let remaining = duration;
let timerInterval;
let running = false;
let firstHalf = true;
let players = [];
let theme = "dark";

function formatTime(sec) {
  const s = Math.max(0, Math.abs(sec));
  const m = Math.floor(s / 60);
  const r = s % 60;
  return `${String(m).padStart(2, "0")}:${String(r).padStart(2, "0")}`;
}

function updateTimerDisplay() {
  document.getElementById("timer").textContent = formatTime(remaining);
}

function tick() {
  remaining--;
  updateTimerDisplay();
  players.forEach(p => {
    if (p.active) {
      p.seconds++;
      if (firstHalf) p.part1++;
      else p.part2++;
    } else {
      p.secondsOut++;
    }
  });
  updateSummary();
  updatePlayersUI();
}

function startTimer() {
  if (running) return;
  running = true;
  timerInterval = setInterval(tick, 1000);
}

function pauseTimer() {
  running = false;
  clearInterval(timerInterval);
}

function resetTimer() {
  pauseTimer();
  const mins = parseInt(document.getElementById("setMinutes").value) || 20;
  duration = mins * 60;
  remaining = duration;
  players.forEach(p => {
    p.seconds = 0;
    p.secondsOut = 0;
    p.part1 = 0;
    p.part2 = 0;
    p.rotations = 0;
    p.lastRotation = 0;
  });
  firstHalf = true;
  updateTimerDisplay();
  updateSummary();
  updatePlayersUI();
  saveData();
}

function intervalTimer() {
  pauseTimer();
  firstHalf = false;
  remaining = parseInt(document.getElementById("setMinutes").value) * 60;
  updateTimerDisplay();
}

function togglePlayer(id) {
  const p = players.find(x => x.id === id);
  if (!p) return;
  p.active = !p.active;
  if (p.active) {
    p.startTime = Date.now();
    p.rotations++;
  } else {
    const last = Math.floor((Date.now() - p.startTime) / 1000);
    p.lastRotation = last;
  }
  updatePlayersUI();
  updateSummary();
  saveData();
}

function updatePlayersUI() {
  players.forEach(p => {
    const div = document.getElementById("player" + p.id);
    div.className = "player " + (p.active ? "active" : "inactive");
    div.querySelector(".time").textContent = p.active
      ? formatTime(p.seconds)
      : formatTime(p.secondsOut);
    div.querySelector(".last").textContent =
      !p.active && p.lastRotation > 0
        ? "Ãšltima rotaÃ§Ã£o: " + formatTime(p.lastRotation)
        : "";
  });
}

function createPlayers(count = 14) {
  const container = document.getElementById("players");
  container.innerHTML = "";
  players = [];
  for (let i = 1; i <= count; i++) {
    const p = {
      id: i,
      name: "Jogador " + i,
      active: false,
      seconds: 0,
      secondsOut: 0,
      part1: 0,
      part2: 0,
      rotations: 0,
      lastRotation: 0,
      startTime: 0,
    };
    players.push(p);

    const div = document.createElement("div");
    div.id = "player" + i;
    div.className = "player inactive";
    div.innerHTML = `<strong>${p.name}</strong><div class="time">00:00</div><div class="last"></div>`;
    div.onclick = () => togglePlayer(i);
    container.appendChild(div);
  }
  updatePlayersUI();
}

function updateSummary() {
  const tbody = document.getElementById("summaryBody");
  tbody.innerHTML = "";
  players.forEach(p => {
    const total = p.part1 + p.part2;
    const avg = p.rotations > 0 ? total / p.rotations : 0;
    const percent = ((total / (duration * (firstHalf ? 1 : 2))) * 100).toFixed(1);
    const workload = p.seconds - p.secondsOut;
    const workClass = workload >= 0 ? "work-pos" : "work-neg";
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${p.name}</td>
      <td>${formatTime(p.seconds)}</td>
      <td>${formatTime(p.secondsOut)}</td>
      <td>${p.rotations}</td>
      <td>${formatTime(avg)}</td>
      <td>${percent}%</td>
      <td class="${workClass}">${workload >= 0 ? "+" : ""}${(workload / 60).toFixed(1)}m</td>
    `;
    tbody.appendChild(tr);
  });
}

function saveData() {
  const data = {
    teamA: document.getElementById("teamA").value,
    players,
    firstHalf,
    remaining,
    duration,
    theme,
  };
  localStorage.setItem("gameControlData", JSON.stringify(data));
}

function loadData() {
  const data = JSON.parse(localStorage.getItem("gameControlData") || "null");
  if (!data) return createPlayers();
  document.getElementById("teamA").value = data.teamA || "";
  duration = data.duration;
  remaining = data.remaining;
  firstHalf = data.firstHalf;
  theme = data.theme || "dark";
  players = data.players || [];
  createPlayers(players.length || 14);
  players.forEach(p => {
    const ref = document.getElementById("player" + p.id);
    if (ref) ref.querySelector("strong").textContent = p.name;
  });
  if (theme === "light") toggleTheme(false);
  updateSummary();
  updatePlayersUI();
  updateTimerDisplay();
}

function printScreen() {
  const original = document.body.innerHTML;
  const header = `<h2 style="text-align:center;">${document.getElementById("teamA").value}</h2>`;
  const table = document.querySelector(".summary").innerHTML;
  const win = window.open("", "", "width=900,height=700");
  win.document.write(`<html><head><title>Game Control</title></head><body>${header}${table}</body></html>`);
  win.document.close();
  win.print();
}

function toggleTheme(save = true) {
  const body = document.body;
  const btn = document.getElementById("themeToggle");
  if (body.classList.contains("light-mode")) {
    body.classList.remove("light-mode");
    btn.textContent = "ðŸŒ™";
    theme = "dark";
  } else {
    body.classList.add("light-mode");
    btn.textContent = "ðŸŒž";
    theme = "light";
  }
  if (save) saveData();
}

document.getElementById("startBtn").onclick = startTimer;
document.getElementById("pauseBtn").onclick = pauseTimer;
document.getElementById("resetBtn").onclick = resetTimer;
document.getElementById("intervalBtn").onclick = intervalTimer;
document.getElementById("printBtn").onclick = printScreen;
document.getElementById("themeToggle").onclick = () => toggleTheme(true);
document.getElementById("fullscreenBtn").onclick = () => {
  if (!document.fullscreenElement) document.documentElement.requestFullscreen();
  else document.exitFullscreen();
};
document.getElementById("addBtn").onclick = () => { createPlayers(players.length + 1); saveData(); };
document.getElementById("removeBtn").onclick = () => { if (players.length > 1) createPlayers(players.length - 1); saveData(); };

setInterval(() => { if (running) saveData(); }, 3000);

window.onload = loadData;
</script>
</body>
</html>
