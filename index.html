<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Game Control</title>

<style>
  :root { --timeline-h: 68px; }

  body{
    font-family:Arial, sans-serif;
    margin:0;
    background:#1e1e1e;
    color:#f5f5f5;
    text-align:center;
    padding-bottom: calc(var(--timeline-h) + 10px);
  }

  header{
    display:flex;
    align-items:center;
    justify-content:center;
    background:#333;
    padding:10px 0;
    position:relative
  }
  header h1{margin:0;font-size:1.5em;text-align:center}
  .top-buttons{
    position:absolute;right:10px;top:8px;
    display:flex;gap:8px
  }
  .top-buttons button{
    background:none;border:none;font-size:22px;
    color:#fff;cursor:pointer
  }

  #teamInputs{
    display:flex;justify-content:center;align-items:center;
    gap:10px;margin:10px
  }
  #teamInputs input{
    padding:6px 10px;border-radius:6px;border:none;
    font-size:16px;text-align:center
  }
  .scoreBubble{
    display:inline-flex;align-items:center;justify-content:center;
    min-width:34px;height:34px;padding:0 8px;margin:0 6px;
    border-radius:8px;background:#111;color:#fff;
    font-weight:800;font-size:20px;
  }
  body.light-mode .scoreBubble{background:#e7e7e7;color:#111}

  .timer-row{
    display:flex;align-items:center;justify-content:center;
    gap:10px;margin:6px 0 0 0
  }
  #timer{font-size:3em}
  .half-badge{
    display:inline-block;padding:4px 10px;border-radius:999px;
    background:#444;color:#fff;font-size:12px;letter-spacing:.3px
  }

  .controls{
    display:flex;justify-content:center;flex-wrap:wrap;
    gap:6px;background:#2e2e2e;padding:10px
  }
  .controls button{
    padding:6px 10px;border:none;border-radius:6px;
    background:#444;color:#fff;cursor:pointer
  }

  /* üî• NOVO ‚Äî GRELHA RESPONSIVA AJUSTADA PARA IPAD */
  #players{
    display:grid;
    grid-template-columns:repeat(5,minmax(0,1fr));
    gap:18px;
    width:95%;
    max-width:1300px;
    margin:12px auto;
    justify-items:center;
    margin-bottom: calc(var(--timeline-h) + 20px);
  }

  /* iPad Pro 1366px ‚Üí 5 colunas */
  @media (max-width:1366px){
    #players{grid-template-columns:repeat(5,minmax(0,1fr));}
  }

  /* iPad Air (1180px) ‚Üí 4 colunas */
  @media (max-width:1180px){
    #players{grid-template-columns:repeat(4,minmax(0,1fr));}
  }

  /* iPad Mini (1024px) ‚Üí 4 colunas */
  @media (max-width:1024px){
    #players{grid-template-columns:repeat(4,minmax(0,1fr));}
  }

  /* Tablets mais pequenos (900px) ‚Üí 3 colunas */
  @media (max-width:900px){
    #players{grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Telem√≥vel grande (600px) ‚Üí 2 colunas */
  @media (max-width:600px){
    #players{grid-template-columns:repeat(2,minmax(0,1fr));}
  }

  .player{
    width:100%;max-width:260px;height:240px;border-radius:14px;
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    cursor:pointer;transition:.2s;background:#c0392b;color:#fff;
    position:relative;overflow:hidden
  }
  .player.active{background:#2ecc71;color:#000}
  .player strong{font-size:20px;margin-bottom:8px}
  .player .time{font-size:40px;font-weight:bold;line-height:1}
  .player .last{font-size:12px;opacity:.9;margin-top:6px}

  .gk-badge{
    position:absolute;top:8px;left:8px;width:28px;height:28px;border-radius:50%;
    display:flex;align-items:center;justify-content:center;
    background:rgba(0,0,0,0.35);
    backdrop-filter:saturate(120%) blur(2px);
    font-size:16px;line-height:1
  }
  .card-badges{
    position:absolute;top:8px;right:8px;
    display:flex;gap:6px;align-items:center
  }
  .badge-fouls{
    min-width:22px;height:22px;border-radius:999px;
    background:#444;color:#fff;font-weight:700;font-size:12px;
    display:flex;align-items:center;justify-content:center;
    padding:0 6px
  }
  .badge-yc,.badge-rc{
    width:16px;height:22px;border-radius:3px;
    border:1px solid rgba(0,0,0,.35)
  }
  .badge-yc{background:#f1c40f}
  .badge-rc{background:#e74c3c}

  .fatigue{
    position:absolute;left:8px;right:8px;bottom:8px;
    height:8px;border-radius:6px;
    background:rgba(255,255,255,0.25)
  }
  .fatigue-fill{height:100%;border-radius:6px;width:0%}

  .player.limit{outline:3px solid #ff4d4d;box-shadow:0 0 0 3px rgba(255,77,77,0.35)}
  .selectable{outline:3px dashed #fff; outline-offset:-4px}

  .summary{
    width:90%;max-width:1100px;margin:18px auto calc(var(--timeline-h) + 20px) auto;
    padding:0;background:#242424;border-radius:12px;
    box-shadow:0 8px 24px rgba(0,0,0,.35);overflow:hidden
  }
  .summary h3{
    margin:0;padding:12px 16px;background:#2f2f2f;
    border-bottom:1px solid #3a3a3a;text-align:left
  }
  .summary table{width:100%;border-collapse:separate;border-spacing:0}
  .summary thead th{
    position:sticky;top:0;background:#303030;z-index:1;
    text-transform:uppercase;font-size:12px;letter-spacing:.4px;
    color:#ddd;border-bottom:1px solid #3a3a3a;padding:10px 12px
  }
  .summary tbody td{padding:10px 12px;border-bottom:1px solid #333}
  .summary tbody tr:nth-child(even){background:rgba(255,255,255,0.03)}
  .summary tbody tr:hover{background:rgba(255,255,255,0.06)}
  .summary td:nth-child(1){text-align:left;font-weight:600}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;font-weight:700}
  .pill.work-pos{color:#2ecc71;background:rgba(46,204,113,.12);border:1px solid rgba(46,204,113,.35)}
  .pill.work-neg{color:#e74c3c;background:rgba(231,76,60,.12);border:1px solid rgba(231,76,60,.35)}
    #editPanel{
    position:fixed; right:-420px; top:20%; width:380px; height:60%;
    background:rgba(0,0,0,0.92); border-left:2px solid #555;
    border-radius:10px 0 0 10px;
    padding:15px; box-shadow:-4px 0 8px rgba(0,0,0,.4);
    transition:right .2s; z-index:999; overflow-y:auto
  }
  #editPanel.open{ right:0; }
  #editPanel .close-btn{
    position:absolute; top:6px; right:8px;
    background:transparent; border:none; color:#fff;
    font-size:18px; cursor:pointer
  }
  #editPanel .row{
    display:flex;align-items:center;gap:8px;margin-bottom:8px
  }
  #editPanel .row input[type="text"]{
    flex:1;padding:6px;border-radius:6px;border:1px solid #777;
    background:#1f1f1f;color:#fff
  }
  #editPanel .row label{
    display:flex;align-items:center;gap:6px;
    color:#ddd;font-size:13px;white-space:nowrap
  }
  #editPanel .save-btn{
    width:100%; padding:8px; border:none; border-radius:6px;
    background:#0078d7; color:#fff; cursor:pointer; margin-top:8px
  }
  #editPanel h3{ margin:0 0 10px 0; }

  #historyPanel{
    position:fixed; left:-420px; top:10%; width:380px; height:80%;
    background:rgba(0,0,0,0.92); border-right:2px solid #555;
    border-radius:0 10px 10px 0;
    padding:15px; box-shadow:4px 0 8px rgba(0,0,0,.4);
    transition:left .2s; z-index:999; overflow-y:auto
  }
  #historyPanel.open{ left:0; }
  #historyPanel .close-btn{
    position:absolute; top:6px; right:8px;
    background:transparent; border:none; color:#fff;
    font-size:18px; cursor:pointer
  }
  .hist-item{
    background:#1f1f1f;border:1px solid #444;border-radius:8px;
    padding:8px;margin-bottom:8px;text-align:left
  }
  .hist-actions{display:flex;gap:6px;margin-top:6px}
  .hist-actions button{
    padding:6px 8px;border:none;border-radius:6px;
    background:#444;color:#fff;cursor:pointer;font-size:12px
  }

  #timelineBar{
    position:fixed;left:0;right:0;bottom:0;
    background:#222;border-top:1px solid #333;z-index:900;
    min-height: var(--timeline-h);
    padding:8px 10px;
    box-shadow:0 -6px 16px rgba(0,0,0,.25)
  }
  #timelineBar .tl-actions{
    display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin-bottom:0
  }
  #timelineBar .tl-btn{
    background:#3a3a3a;color:#fff;border:none;border-radius:8px;
    padding:6px 10px;cursor:pointer;font-size:13px
  }
  #tlClear{
    background:#a33;color:#fff;border:none;border-radius:8px;
    padding:6px 10px;cursor:pointer
  }
  #timelineFeed{display:none}
  .tl-gf{color:#2ecc71}.tl-ga{color:#e74c3c}.tl-fk{color:#f1c40f}.tl-yc{color:#f1c40f}.tl-rc{color:#e74c3c}
</style>
</head>
<body>

<header>
  <h1>Game Control</h1>
  <div class="top-buttons">
    <button id="themeToggle" title="Tema">üåô</button>
    <button id="fullscreenBtn" title="Fullscreen">‚õ∂</button>
    <button id="editNamesBtn" title="Editar nomes">üë•</button>
    <button id="presetsBtn" title="Presets">üíæ</button>
    <button id="analyticsBtn" title="An√°lises">üìä</button>
    <button id="printBtn" title="Exportar PNG">üì∏</button>
  </div>
</header>

<div id="teamInputs">
  <span class="scoreBubble" id="scoreA">0</span>
  <input id="teamA" placeholder="Equipa A" />
  <span style="font-weight:bold;">vs</span>
  <input id="teamB" placeholder="Equipa B" />
  <span class="scoreBubble" id="scoreB">0</span>
</div>

<div class="timer-row">
  <div id="timer">20:00</div>
  <span id="halfBadge" class="half-badge">1¬™ Parte</span>
</div>

<div class="controls">
  <input id="setMinutes" type="number" value="20" min="1" style="width:60px;">
  <button id="startBtn">Iniciar</button>
  <button id="pauseBtn">Pausar</button>
  <button id="intervalBtn">Intervalo</button>
  <button id="resetBtn">Reset</button>
  <button id="addBtn">+</button>
  <button id="removeBtn">‚àí</button>
  <button id="saveGameBtn">Guardar Jogo</button>
  <button id="historyBtn">Hist√≥rico</button>
</div>

<div id="players"></div>

<div class="summary">
  <h3>Resumo de Jogo</h3>
  <table>
    <thead>
      <tr>
        <th>Jogador</th>
        <th>1¬™ Parte</th>
        <th>2¬™ Parte</th>
        <th>Total em Campo</th>
        <th>Tempo Fora</th>
        <th>Rota√ß√µes</th>
        <th>M√©dia</th>
        <th>% Jogo</th>
        <th>Workload</th>
      </tr>
    </thead>
    <tbody id="summaryBody"></tbody>
  </table>
</div>

<!-- Painel Editar nomes -->
<div id="editPanel">
  <button class="close-btn" id="closePanel">‚ùå</button>
  <h3>Editar Jogadores</h3>
  <div id="editList"></div>
  <button class="save-btn" id="saveNamesBtn">Guardar Altera√ß√µes</button>
</div>

<!-- Painel Hist√≥rico -->
<div id="historyPanel">
  <button class="close-btn" id="closeHistory">‚ùå</button>
  <h3>Hist√≥rico de Jogos</h3>
  <div id="historyList"></div>
  <div style="margin-top:8px;display:flex;gap:6px;justify-content:center">
    <button id="exportAllCsvBtn">Exportar CSV (tudo)</button>
    <button id="clearHistoryBtn" style="background:#a33">Apagar Hist√≥rico</button>
  </div>
</div>

<!-- Painel Presets -->
<div id="presetsPanel" style="position:fixed; right:-420px; top:10%; width:380px; height:80%;
  background:rgba(0,0,0,0.92); border-left:2px solid #555; border-radius:10px 0 0 10px;
  padding:15px; box-shadow:-4px 0 8px rgba(0,0,0,.4); transition:right .2s; z-index:999; overflow-y:auto">
  <button id="closePresets" style="position:absolute; top:6px; right:8px; background:transparent; border:none; color:#fff; font-size:18px; cursor:pointer">‚ùå</button>
  <h3 style="margin:0 0 10px 0;">Presets de Plantel</h3>

  <div style="display:flex; gap:6px; margin-bottom:8px;">
    <input id="presetName" placeholder="Nome do preset" style="flex:1;padding:6px;border-radius:6px;border:1px solid #777;background:#1f1f1f;color:#fff"/>
    <button id="savePresetBtn" style="padding:6px 10px;border:none;border-radius:6px;background:#0078d7;color:#fff;cursor:pointer">Guardar</button>
  </div>

  <div>
    <h4 style="margin:10px 0 6px 0;">Carregar</h4>
    <div id="presetList"></div>
  </div>
</div>

<!-- Painel An√°lises -->
<div id="analyticsPanel" style="position:fixed; left:-520px; top:6%; width:480px; height:88%;
  background:rgba(0,0,0,0.96); border-right:2px solid #555; border-radius:0 10px 10px 0;
  padding:14px; box-shadow:4px 0 10px rgba(0,0,0,.45); transition:left .2s; z-index:999; overflow-y:auto">
  <button id="closeAnalytics" style="position:absolute; top:6px; right:8px; background:transparent; border:none; color:#fff; font-size:18px; cursor:pointer">‚ùå</button>
  <h3 style="margin:0 0 10px 0;">An√°lises</h3>

  <div id="anaQuintetos" style="margin-bottom:12px;"></div>
  <div id="anaStints" style="margin-bottom:12px;"></div>
  <div id="anaPartes" style="margin-bottom:12px;"></div>

  <button id="exportAnalyticsCsv" style="padding:8px 10px;border:none;border-radius:6px;background:#0078d7;color:#fff;cursor:pointer;width:100%;margin-top:6px">
    Exportar CSV
  </button>
</div>

<!-- Timeline -->
<div id="timelineBar">
  <div class="tl-actions">
    <button class="tl-btn" data-type="GF_A" title="Golo a favor">‚öΩ +</button>
    <button class="tl-btn" data-type="GA_A" title="Golo sofrido">‚öΩ ‚àí</button>
    <button class="tl-btn tl-player" data-type="FK_P" title="Falta (seleciona jogador)">‚ùå Falta</button>
    <button class="tl-btn tl-player" data-type="YC_P" title="Amarelo (seleciona jogador)">üü® Amarelo</button>
    <button class="tl-btn tl-player" data-type="RC_P" title="Vermelho (seleciona jogador)">üü• Vermelho</button>
    <button id="tlClear" title="Limpar eventos">üßπ</button>
  </div>

  <div id="timelineFeed"></div>
</div><script>
/* ============================================================
   VARI√ÅVEIS PRINCIPAIS
   ============================================================ */

let duration = 20 * 60;
let remaining = duration;
let timerInterval;
let running = false;
let firstHalf = true;
let players = [];
let theme = "dark";

let maxOnField = 5; // Limite de jogadores em campo
let fatigueIncreaseRate = 1; 
let fatigueDecreaseRate = 2;

let timeline = [];
let gameHistory = [];
let presets = [];

/* ============================================================
   FUN√á√ïES BASE
   ============================================================ */

function formatTime(sec) {
  const s = Math.max(0, Math.abs(sec));
  const m = Math.floor(s / 60);
  const r = s % 60;
  return `${String(m).padStart(2, "0")}:${String(r).padStart(2, "0")}`;
}

function updateTimerDisplay() {
  document.getElementById("timer").textContent = formatTime(remaining);
}

/* ============================================================
   L√ìGICA DO REL√ìGIO
   ============================================================ */

function tick() {
  remaining--;
  updateTimerDisplay();

  players.forEach(p => {
    // FADIGA
    if (!p.isGK) {
      if (p.active) {
        p.fatigue += fatigueIncreaseRate;
      } else {
        p.fatigue -= fatigueDecreaseRate;
      }
      p.fatigue = Math.max(0, Math.min(100, p.fatigue));
    }

    // TEMPOS
    if (p.active) {
      p.seconds++;
      if (firstHalf) p.part1++;
      else p.part2++;
      p.rotationSecondsCurrent++;
    } else {
      p.secondsOut++;
      p.rotationSecondsOut++;
    }
  });

  updatePlayersUI();
  updateSummary();
}

function startTimer() {
  if (running) return;
  running = true;
  timerInterval = setInterval(tick, 1000);
}

function pauseTimer() {
  running = false;
  clearInterval(timerInterval);
}

function resetTimer() {
  pauseTimer();

  const mins = parseInt(document.getElementById("setMinutes").value) || 20;
  duration = mins * 60;
  remaining = duration;
  firstHalf = true;

  players.forEach(p => {
    p.seconds = 0;
    p.secondsOut = 0;
    p.part1 = 0;
    p.part2 = 0;
    p.rotations = 0;
    p.rotationSecondsCurrent = 0;
    p.rotationSecondsOut = 0;
    p.startTime = 0;
    p.lastRotation = 0;
    p.fatigue = 0;
  });

  document.getElementById("halfBadge").textContent = "1¬™ Parte";

  updateTimerDisplay();
  updatePlayersUI();
  updateSummary();
}

function intervalTimer() {
  pauseTimer();
  firstHalf = false;
  document.getElementById("halfBadge").textContent = "2¬™ Parte";

  players.forEach(p => {
    p.rotationSecondsCurrent = 0;
    p.rotationSecondsOut = 0;
    p.lastRotation = 0;
    if (!p.isGK) p.fatigue = Math.max(0, p.fatigue - 40);
  });

  const mins = parseInt(document.getElementById("setMinutes").value) || 20;
  remaining = mins * 60;
  updateTimerDisplay();
}

/* ============================================================
   ALTERAR JOGADOR / ROTA√á√ïES
   ============================================================ */

function togglePlayer(id) {
  const p = players.find(x => x.id === id);
  if (!p) return;

  const currentlyOnField = players.filter(x => x.active).length;

  if (!p.active && currentlyOnField >= maxOnField) {
    alert("S√≥ podem estar 5 jogadores em campo.");
    return;
  }

  p.active = !p.active;

  if (p.active) {
    p.rotations++;
    p.rotationSecondsCurrent = 0;
    p.startTime = Date.now();
  } else {
    p.lastRotation = p.rotationSecondsCurrent;
    p.rotationSecondsCurrent = 0;
    p.rotationSecondsOut = 0;
  }

  updatePlayersUI();
  updateSummary();
}

/* ============================================================
   UI ‚Äî CAIXAS DOS JOGADORES
   ============================================================ */

function fatigueColor(v) {
  if (v < 30) return "#2ecc71";
  if (v < 60) return "#f1c40f";
  return "#e74c3c";
}

function updatePlayersUI() {
  players.forEach(p => {
    const box = document.getElementById("player" + p.id);
    if (!box) return;

    box.className = "player " + (p.active ? "active" : "inactive");

    box.querySelector(".name").textContent = p.name;
    box.querySelector(".time").textContent = formatTime(
      p.active ? p.rotationSecondsCurrent : p.rotationSecondsOut
    );

    const bar = box.querySelector(".fatigue-bar");
    bar.style.width = p.fatigue + "%";
    bar.style.background = fatigueColor(p.fatigue);

    const gkIcon = box.querySelector(".gk-icon");
    gkIcon.style.display = p.isGK ? "block" : "none";
  });
}

/* ============================================================
   CRIAR / RECRIAR JOGADORES
   ============================================================ */

function createPlayers(count = 12) {
  const container = document.getElementById("players");
  container.innerHTML = "";
  players = [];

  for (let i = 1; i <= count; i++) {
    const p = {
      id: i,
      name: "Jogador " + i,
      active: false,
      isGK: i === 1 ? true : false,
      seconds: 0,
      secondsOut: 0,
      part1: 0,
      part2: 0,
      rotations: 0,
      rotationSecondsCurrent: 0,
      rotationSecondsOut: 0,
      startTime: 0,
      lastRotation: 0,
      fatigue: 0,
    };

    players.push(p);

    const div = document.createElement("div");
    div.id = "player" + i;
    div.className = "player inactive";

    div.innerHTML = `
      <div class="gk-icon">üß§</div>
      <strong class="name">${p.name}</strong>
      <div class="time">00:00</div>
      <div class="fatigue-container"><div class="fatigue-bar"></div></div>
    `;

    div.onclick = () => togglePlayer(i);
    container.appendChild(div);
  }

  updatePlayersUI();
}

/* ============================================================
   RESUMO / TABELA
   ============================================================ */

function updateSummary() {
  const tbody = document.getElementById("summaryBody");
  tbody.innerHTML = "";

  players.forEach(p => {
    const total = p.part1 + p.part2;
    const avg = p.rotations > 0 ? total / p.rotations : 0;
    const percent = ((total / (duration * 2)) * 100).toFixed(1);

    const workload = p.seconds - p.secondsOut;
    const workloadClass = workload >= 0 ? "work-pos" : "work-neg";

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${p.name}</td>
      <td>${formatTime(p.part1)}</td>
      <td>${formatTime(p.part2)}</td>
      <td>${formatTime(total)}</td>
      <td>${formatTime(p.secondsOut)}</td>
      <td>${p.rotations}</td>
      <td>${formatTime(avg)}</td>
      <td>${percent}%</td>
      <td class="${workloadClass}">${workload >= 0 ? "+" : ""}${(workload / 60).toFixed(1)}m</td>
    `;
    tbody.appendChild(tr);
  });
}

/* ============================================================
   EXPORTAR IMAGEM
   ============================================================ */

function printScreen() {
  const area = document.querySelector(".summary").cloneNode(true);
  const teamTitle = document.createElement("h2");
  teamTitle.textContent =
    document.getElementById("teamA").value +
    " vs " +
    document.getElementById("teamB").value;

  const wrapper = document.createElement("div");
  wrapper.style.background = "#fff";
  wrapper.style.padding = "20px";
  wrapper.appendChild(teamTitle);
  wrapper.appendChild(area);

  html2canvas(wrapper).then(canvas => {
    const link = document.createElement("a");
    link.download = "gamecontrol.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
  });
}

/* ============================================================
   CONTINUA NA PARTE 4‚Ä¶
   ============================================================ */

</script><script>
/* ============================================================
   GUARDAR E CARREGAR (AUTOSAVE)
   ============================================================ */

function saveData() {
  const data = {
    teamA: document.getElementById("teamA").value,
    teamB: document.getElementById("teamB").value,
    duration,
    remaining,
    firstHalf,
    players,
    timeline
  };
  localStorage.setItem("gameControlSave", JSON.stringify(data));
}

function loadData() {
  const saved = localStorage.getItem("gameControlSave");
  if (!saved) {
    createPlayers(12);
    return;
  }

  const data = JSON.parse(saved);

  document.getElementById("teamA").value = data.teamA;
  document.getElementById("teamB").value = data.teamB;

  duration = data.duration;
  remaining = data.remaining;
  firstHalf = data.firstHalf;
  players = data.players;
  timeline = data.timeline || [];

  recreatePlayersFromSave();
  updateSummary();
  updatePlayersUI();
  updateTimerDisplay();
}

function recreatePlayersFromSave() {
  const container = document.getElementById("players");
  container.innerHTML = "";

  players.forEach(p => {
    const div = document.createElement("div");
    div.id = "player" + p.id;
    div.className = "player " + (p.active ? "active" : "inactive");

    div.innerHTML = `
      <div class="gk-icon" style="display:${p.isGK ? "block" : "none"}">üß§</div>
      <strong class="name">${p.name}</strong>
      <div class="time">00:00</div>
      <div class="fatigue-container"><div class="fatigue-bar"></div></div>
    `;

    div.onclick = () => togglePlayer(p.id);
    container.appendChild(div);
  });

  updatePlayersUI();
}

/* ============================================================
   TIMELINE (EVENTOS)
   ============================================================ */

function addTimelineEvent(type, playerId = null) {
  const event = {
    time: formatTime(duration - remaining),
    type,
    playerId,
    playerName: playerId ? players.find(p => p.id === playerId).name : null
  };

  timeline.push(event);
  renderTimeline();
  saveData();
}

function renderTimeline() {
  const list = document.getElementById("timelineEvents");
  if (!list) return;

  list.innerHTML = "";

  timeline.forEach(ev => {
    const li = document.createElement("li");
    li.className = "timeline-item";

    let icon = "";
    if (ev.type === "goal") icon = "‚öΩ";
    if (ev.type === "yellow") icon = "üü®";
    if (ev.type === "red") icon = "üü•";
    if (ev.type === "foul") icon = "‚ùó";

    li.innerHTML = `
      <div class="time">${ev.time}</div>
      <div class="desc">${icon} ${ev.playerName || ""}</div>
    `;
    list.appendChild(li);
  });
}

/* ============================================================
   EVENTOS DO JOGO
   ============================================================ */

function selectPlayerForEvent(actionType) {
  const modal = document.getElementById("playerSelectModal");
  const list = document.getElementById("playerSelectList");

  modal.style.display = "flex";
  list.innerHTML = "";

  players.forEach(p => {
    const div = document.createElement("div");
    div.className = "select-player-item";
    div.textContent = p.name;
    div.onclick = () => {
      addTimelineEvent(actionType, p.id);
      modal.style.display = "none";
    };
    list.appendChild(div);
  });
}

function closeModal() {
  document.getElementById("playerSelectModal").style.display = "none";
}

/* ============================================================
   FULLSCREEN
   ============================================================ */

function toggleFullscreen() {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen();
  } else {
    document.exitFullscreen();
  }
}

/* ============================================================
   EVENTOS DOS BOT√ïES
   ============================================================ */

document.getElementById("startBtn").onclick = startTimer;
document.getElementById("pauseBtn").onclick = pauseTimer;
document.getElementById("resetBtn").onclick = resetTimer;
document.getElementById("intervalBtn").onclick = intervalTimer;
document.getElementById("printBtn").onclick = printScreen;
document.getElementById("fullscreenBtn").onclick = toggleFullscreen;
document.getElementById("addBtn").onclick = () => createPlayers(players.length + 1);
document.getElementById("removeBtn").onclick = () => {
  if (players.length > 1) createPlayers(players.length - 1);
};

document.getElementById("goalBtn").onclick = () => selectPlayerForEvent("goal");
document.getElementById("yellowBtn").onclick = () => selectPlayerForEvent("yellow");
document.getElementById("redBtn").onclick = () => selectPlayerForEvent("red");
document.getElementById("foulBtn").onclick = () => selectPlayerForEvent("foul");

setInterval(saveData, 2500);

/* ============================================================
   INICIAR
   ============================================================ */

window.onload = loadData;
</script>

</body>
</html>
