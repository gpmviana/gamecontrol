<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Game Control</title>
<style>
  :root {
    --bg-color: #1e1e1e;
    --text-color: #f1f1f1;
    --box-bg: #2b2b2b;
    --active-bg: #2e7d32;
    --inactive-bg: #8B0000;
    --border-color: #555;
    --accent-color: #4CAF50;
  }
  body.light {
    --bg-color: #ffffff;
    --text-color: #000000;
    --box-bg: #f2f2f2;
    --active-bg: #a5d6a7;
    --inactive-bg: #ff8a80;
    --border-color: #ccc;
    --accent-color: #388e3c;
  }
  body {
    font-family: Arial, sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: background-color 0.3s, color 0.3s;
  }
  h1 {
    background-color: var(--box-bg);
    width: 100%;
    text-align: center;
    padding: 10px 0;
    margin: 0;
  }
  .topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 90%;
    max-width: 1000px;
    margin-top: 10px;
  }
  .team-input {
    background: var(--box-bg);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    color: var(--text-color);
    padding: 6px;
    width: 160px;
    text-align: center;
  }
  .mode-toggle {
    background: none;
    border: none;
    color: var(--text-color);
    font-size: 28px;
    cursor: pointer;
    margin-left: 10px;
  }
  .timer { font-size: 64px; margin: 10px 0; }
  .controls {
    display: flex; flex-wrap: wrap; justify-content: center;
    align-items: center; gap: 6px;
  }
  .controls button {
    padding: 10px 16px; font-size: 15px;
    border-radius: 8px; border: none; cursor: pointer;
  }
  #playersBtn,#addBtn,#removeBtn { background:var(--box-bg);color:var(--text-color);}
  #startBtn{background:#4CAF50;color:#fff;}
  #pauseBtn{background:#E53935;color:#fff;}
  #intervalBtn{background:#FBC02D;color:#000;}
  #resetBtn{background:#607D8B;color:#fff;}
  #printBtn{background:#9C27B0;color:#fff;}
  #fullscreenBtn{background:#212121;color:#fff;}
  .players {
    display: flex; flex-wrap: wrap; justify-content: center;
    gap: 12px; margin-top: 25px; max-width: 1200px;
  }
  .player {
    width: 230px; height: 150px; background: var(--box-bg);
    border-radius: 12px; display: flex; flex-direction: column;
    align-items: center; justify-content: space-between;
    font-weight: bold; cursor: pointer; user-select: none; padding: 8px;
  }
  .player.active { background: var(--active-bg); color: #fff; }
  .player.inactive { background: var(--inactive-bg); color: #fff; position: relative; }
  .player-name { font-size: 16px; }
  .player-time { font-size: 36px; line-height: 1; }
  .last-rotation { font-size: 12px; color: var(--accent-color); }
  @media (max-width: 1000px) {
    .player { width: 180px; height: 120px; }
    .player-time { font-size: 30px; }
  }
  @media (max-width: 600px) {
    .player { width: 140px; height: 100px; }
    .player-time { font-size: 24px; }
  }
  .summary {
    margin-top:30px;width:95%;max-width:1000px;
    background:var(--box-bg);border-radius:10px;padding:10px;
  }
  table{width:100%;border-collapse:collapse;}
  th,td{border:1px solid var(--border-color);padding:5px;text-align:center;}
  .workload-high{color:#00e676;font-weight:bold;}
  .workload-low{color:#ff5252;font-weight:bold;}
</style>
</head>
<body>
<h1>Game Control</h1>

<div class="topbar">
  <input id="teamA" class="team-input" placeholder="Equipa A">
  <div class="timer" id="timer">20:00</div>
  <div style="display:flex;align-items:center;">
    <input id="teamB" class="team-input" placeholder="Equipa B">
    <button id="modeToggle" class="mode-toggle" title="Alternar modo">ðŸŒž</button>
  </div>
</div>

<div class="controls">
  <input type="number" id="setMinutes" value="20" min="1" style="width:60px;"> min
  <button id="startBtn">Iniciar</button>
  <button id="pauseBtn">Pausar</button>
  <button id="intervalBtn">Intervalo</button>
  <button id="resetBtn">Reset</button>
  <button id="addBtn">âž•</button>
  <button id="removeBtn">âž–</button>
  <button id="printBtn">ðŸ“¸</button>
  <button id="fullscreenBtn">â›¶</button>
</div>

<div class="players" id="players"></div>

<div class="summary">
  <h3>Resumo de Jogo</h3>
  <table>
    <thead>
      <tr>
        <th>Jogador</th><th>1.Âª Parte</th><th>2.Âª Parte</th>
        <th>Total</th><th>Tempo Fora</th><th>RotaÃ§Ãµes</th>
        <th>Workload</th><th>% Jogo</th>
      </tr>
    </thead>
    <tbody id="summaryBody"></tbody>
  </table>
</div>

<script>
let duration=20*60,remaining=duration,timerInterval,running=false,isSecondHalf=false;
let players=[],playerCount=14;

function formatTime(sec){const s=Math.abs(sec),m=Math.floor(s/60),r=s%60;return String(m).padStart(2,"0")+":"+String(r).padStart(2,"0");}
function updateTimerDisplay(){document.getElementById("timer").textContent=formatTime(remaining);}
function tick(){
  remaining--;
  updateTimerDisplay();
  players.forEach(p=>{
    if(p.active){
      if(isSecondHalf)p.secondsP2++; else p.secondsP1++;
      p.secondsIn++;
    } else p.secondsOut++;
  });
  updatePlayersDisplay();updateSummary();autoSave();
}
function startTimer(){if(running)return;running=true;timerInterval=setInterval(tick,1000);}
function pauseTimer(){running=false;clearInterval(timerInterval);}
function resetTimer(){
  pauseTimer();const mins=parseInt(document.getElementById("setMinutes").value)||20;
  duration=mins*60;remaining=duration;isSecondHalf=false;
  players.forEach(p=>{p.secondsP1=p.secondsP2=p.secondsIn=p.secondsOut=p.rotations=0;p.active=false;p.lastRotation=0;});
  updateTimerDisplay();updatePlayersDisplay();updateSummary();autoSave();
}
function intervalTimer(){
  pauseTimer();isSecondHalf=true;
  const mins=parseInt(document.getElementById("setMinutes").value)||20;
  remaining=mins*60;updateTimerDisplay();autoSave();
}
function createPlayers(n){
  const c=document.getElementById("players");players=[];
  for(let i=1;i<=n;i++){
    const p={id:i,name:"Jogador "+i,active:false,secondsIn:0,secondsOut:0,secondsP1:0,secondsP2:0,rotations:0,lastRotation:0};
    players.push(p);
    const d=document.createElement("div");
    d.className="player inactive";d.id="player"+i;
    d.innerHTML=`<div class='player-name'>${p.name}</div><div class='player-time'>00:00</div><div class='last-rotation'></div>`;
    d.onclick=()=>togglePlayer(i);c.appendChild(d);
  }
  updateSummary();autoSave();
}
function togglePlayer(id){
  const p=players.find(x=>x.id===id);
  if(!p)return;
  const box=document.getElementById("player"+id);
  const info=box.querySelector(".last-rotation");
  if(p.active){ 
    p.lastRotation = (isSecondHalf?p.secondsP2:p.secondsP1) - p.rotationStart;
    info.textContent = "Ãšltima rotaÃ§Ã£o: "+formatTime(p.lastRotation);
  } else {
    p.rotationStart = (isSecondHalf?p.secondsP2:p.secondsP1);
    info.textContent = "";
    p.rotations++;
  }
  p.active=!p.active;
  box.className=p.active?"player active":"player inactive";
  updatePlayersDisplay();
  autoSave();
}
function updatePlayersDisplay(){
  players.forEach(p=>{
    const box=document.getElementById("player"+p.id);
    const t=box.querySelector(".player-time");
    t.textContent=p.active?formatTime(p.secondsIn):formatTime(p.secondsOut);
  });
}
function calculateWorkload(p){return (p.secondsIn - p.secondsOut)/60;}
function updateSummary(){
  const tb=document.getElementById("summaryBody");tb.innerHTML="";
  const workloads=players.map(p=>calculateWorkload(p));
  const avg=workloads.reduce((a,b)=>a+b,0)/(workloads.length||1);
  players.forEach(p=>{
    const totalIn=p.secondsP1+p.secondsP2;const total=p.secondsIn+p.secondsOut;
    const perc=total>0?((p.secondsIn/total)*100).toFixed(1)+"%":"0%";
    const wl=calculateWorkload(p);const wlClass=wl>=avg?"workload-high":"workload-low";
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${p.name}</td>
      <td>${formatTime(p.secondsP1)}</td>
      <td>${formatTime(p.secondsP2)}</td>
      <td>${formatTime(totalIn)}</td>
      <td>${formatTime(p.secondsOut)}</td>
      <td>${p.rotations}</td>
      <td class="${wlClass}">${wl.toFixed(1)}</td>
      <td>${perc}</td>`;
    tb.appendChild(tr);
  });
}
function printSummary(){
  const teamA=document.getElementById("teamA").value||"Equipa A";
  const teamB=document.getElementById("teamB").value||"Equipa B";
  const table=document.querySelector(".summary").innerHTML;
  const w=window.open("","",`width=900,height=700`);
  w.document.write(`<html><head><title>Resumo</title>
  <style>body{font-family:Arial;background:#fff;color:#000;}
  table{width:100%;border-collapse:collapse;margin-top:20px;}
  th,td{border:1px solid #000;padding:6px;text-align:center;}th{background:#eee;}</style>
  </head><body><h2 style="text-align:center;">${teamA} vs ${teamB}</h2>${table}</body></html>`);
  w.document.close();w.print();
}
document.getElementById("printBtn").onclick=printSummary;
document.getElementById("fullscreenBtn").onclick=()=>{if(!document.fullscreenElement)document.documentElement.requestFullscreen();else document.exitFullscreen();};
document.getElementById("startBtn").onclick=startTimer;
document.getElementById("pauseBtn").onclick=pauseTimer;
document.getElementById("intervalBtn").onclick=intervalTimer;
document.getElementById("resetBtn").onclick=resetTimer;
document.getElementById("addBtn").onclick=()=>{playerCount++;const p={id:playerCount,name:"Jogador "+playerCount,active:false,secondsIn:0,secondsOut:0,secondsP1:0,secondsP2:0,rotations:0,lastRotation:0};players.push(p);const d=document.createElement("div");d.className="player inactive";d.id="player"+p.id;d.innerHTML=`<div class='player-name'>${p.name}</div><div class='player-time'>00:00</div><div class='last-rotation'></div>`;d.onclick=()=>togglePlayer(p.id);document.getElementById("players").appendChild(d);autoSave();};
document.getElementById("removeBtn").onclick=()=>{if(players.length<=1)return;const p=players.pop();document.getElementById("player"+p.id)?.remove();autoSave();};
function autoSave(){localStorage.setItem("gameControlData",JSON.stringify({players,remaining,duration,isSecondHalf,playerCount,teamA:document.getElementById("teamA").value,teamB:document.getElementById("teamB").value,mode:document.body.classList.contains("light")?"light":"dark"}));}
function restoreData(){const saved=localStorage.getItem("gameControlData");if(!saved)return;try{const d=JSON.parse(saved);duration=d.duration;remaining=d.remaining;isSecondHalf=d.isSecondHalf||false;playerCount=d.playerCount||14;players=d.players;document.getElementById("teamA").value=d.teamA||"";document.getElementById("teamB").value=d.teamB||"";if(d.mode==="light"){document.body.classList.add("light");document.getElementById("modeToggle").textContent="ðŸŒ™";}const c=document.getElementById("players");c.innerHTML="";players.forEach(p=>{p.secondsP1=p.secondsP1||0;p.secondsP2=p.secondsP2||0;const div=document.createElement("div");div.id="player"+p.id;div.className=p.active?"player active":"player inactive";div.innerHTML=`<div class='player-name'>${p.name}</div><div class='player-time'>${p.active?formatTime(p.secondsIn):formatTime(p.secondsOut)}</div><div class='last-rotation'>${p.lastRotation?"Ãšltima rotaÃ§Ã£o: "+formatTime(p.lastRotation):""}</div>`;div.onclick=()=>togglePlayer(p.id);c.appendChild(div);});}catch(e){console.error("Erro ao restaurar",e);}}
document.getElementById("modeToggle").onclick=()=>{document.body.classList.toggle("light");const isLight=document.body.classList.contains("light");document.getElementById("modeToggle").textContent=isLight?"ðŸŒ™":"ðŸŒž";autoSave();};
window.onload=()=>{restoreData();if(players.length===0)createPlayers(14);updateTimerDisplay();setInterval(()=>{updatePlayersDisplay();updateSummary();},1000);}
</script>
</body>
</html>
