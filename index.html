<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Game Control</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #1e1e1e;
    color: #f1f1f1;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    background-color: #333;
    width: 100%;
    text-align: center;
    padding: 10px 0;
    margin: 0;
  }
  .topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 90%;
    max-width: 1000px;
    margin-top: 10px;
  }
  .team-input {
    background: #2b2b2b;
    border: 1px solid #555;
    border-radius: 6px;
    color: #fff;
    padding: 6px;
    width: 160px;
    text-align: center;
  }
  .timer { font-size: 64px; margin: 10px 0; }
  .controls { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 6px; }
  .controls button { padding: 10px 16px; font-size: 15px; border-radius: 8px; border: none; cursor: pointer; }
  #playersBtn,#addBtn,#removeBtn { background:#555;color:#fff;}
  #startBtn{background:#4CAF50;color:#fff;}
  #pauseBtn{background:#E53935;color:#fff;}
  #intervalBtn{background:#FBC02D;color:#000;}
  #resetBtn{background:#607D8B;color:#fff;}
  #printBtn{background:#9C27B0;color:#fff;}
  #fullscreenBtn{background:#212121;color:#fff;}
  .players{display:flex;flex-wrap:wrap;justify-content:center;gap:12px;margin-top:25px;}
  .player{
    width:200px;height:120px;background:#2b2b2b;border-radius:12px;
    display:flex;flex-direction:column;align-items:center;justify-content:space-between;
    font-weight:bold;cursor:pointer;user-select:none;padding:8px;
  }
  .player.active{background:#2e7d32;color:#fff;}
  .player.inactive{background:#8B0000;color:#fff;position:relative;}
  .player-name{font-size:16px;}
  .player-time{font-size:36px;line-height:1;}
  .last-rotation {font-size: 12px;color: #4CAF50;}
  .summary{
    margin-top:30px;width:95%;max-width:1000px;
    background:#2b2b2b;border-radius:10px;padding:10px;
  }
  table{width:100%;border-collapse:collapse;}
  th,td{border:1px solid #555;padding:5px;text-align:center;}
  .workload-high{color:#00e676;font-weight:bold;}
  .workload-low{color:#ff5252;font-weight:bold;}
  #playerPanel{
    position:fixed;top:0;right:-320px;width:300px;height:100%;
    background:#121212;color:#fff;box-shadow:-2px 0 6px rgba(0,0,0,.4);
    transition:right .3s;padding:20px;overflow-y:auto;z-index:10;
  }
  #playerPanel.open{right:0;}
  #playerPanel h2{text-align:center;}
  #playerPanel input{width:100%;margin:4px 0;padding:4px;}
  #closePanelBtn{background:#444;color:#fff;border:none;padding:8px 12px;margin-top:10px;cursor:pointer;width:100%;}
</style>
</head>
<body>
<h1>Game Control</h1>

<div class="topbar">
  <input id="teamA" class="team-input" placeholder="Equipa A">
  <div class="timer" id="timer">20:00</div>
  <input id="teamB" class="team-input" placeholder="Equipa B">
</div>

<div class="controls">
  <input type="number" id="setMinutes" value="20" min="1" style="width:60px;"> min
  <button id="startBtn">Iniciar</button>
  <button id="pauseBtn">Pausar</button>
  <button id="intervalBtn">Intervalo</button>
  <button id="resetBtn">Reset</button>
  <button id="playersBtn">üßç‚Äç‚ôÇÔ∏è Jogadores</button>
  <button id="addBtn">‚ûï</button>
  <button id="removeBtn">‚ûñ</button>
  <button id="printBtn">üì∏</button>
  <button id="fullscreenBtn">‚õ∂</button>
</div>

<div class="players" id="players"></div>

<div class="summary">
  <h3>Resumo de Jogo</h3>
  <table>
    <thead>
      <tr>
        <th>Jogador</th><th>1.¬™ Parte</th><th>2.¬™ Parte</th><th>Total</th><th>Tempo Fora</th><th>Rota√ß√µes</th><th>Workload</th><th>% Jogo</th>
      </tr>
    </thead>
    <tbody id="summaryBody"></tbody>
  </table>
</div>

<div id="playerPanel">
  <h2>Editar Jogadores</h2>
  <div id="playerList"></div>
  <button id="closePanelBtn">Fechar</button>
</div>

<script>
let duration=20*60,remaining=duration,timerInterval,running=false,isSecondHalf=false;
let players=[],playerCount=14;

function formatTime(sec){const s=Math.abs(sec),m=Math.floor(s/60),r=s%60;return String(m).padStart(2,"0")+":"+String(r).padStart(2,"0");}
function updateTimerDisplay(){document.getElementById("timer").textContent=formatTime(remaining);}
function tick(){
  remaining--;
  updateTimerDisplay();
  players.forEach(p=>{
    if(p.active){
      if(isSecondHalf)p.secondsP2++; else p.secondsP1++;
      p.secondsIn++;
    } else p.secondsOut++;
  });
  updatePlayersDisplay();updateSummary();autoSave();
}
function startTimer(){if(running)return;running=true;timerInterval=setInterval(tick,1000);}
function pauseTimer(){running=false;clearInterval(timerInterval);}
function resetTimer(){
  pauseTimer();const mins=parseInt(document.getElementById("setMinutes").value)||20;
  duration=mins*60;remaining=duration;isSecondHalf=false;
  players.forEach(p=>{p.secondsP1=p.secondsP2=p.secondsIn=p.secondsOut=p.rotations=0;p.active=false;p.lastRotation=0;});
  updateTimerDisplay();updatePlayersDisplay();updateSummary();autoSave();
}
function intervalTimer(){
  pauseTimer();isSecondHalf=true;
  const mins=parseInt(document.getElementById("setMinutes").value)||20;
  remaining=mins*60;updateTimerDisplay();autoSave();
}

function createPlayers(n){
  const c=document.getElementById("players");players=[];
  for(let i=1;i<=n;i++){
    const p={id:i,name:"Jogador "+i,active:false,secondsIn:0,secondsOut:0,secondsP1:0,secondsP2:0,rotations:0,lastRotation:0};
    players.push(p);
    const d=document.createElement("div");
    d.className="player inactive";d.id="player"+i;
    d.innerHTML=`<div class='player-name'>${p.name}</div><div class='player-time'>00:00</div><div class='last-rotation'></div>`;
    d.onclick=()=>togglePlayer(i);c.appendChild(d);
  }
  updateSummary();autoSave();
}

function togglePlayer(id){
  const p=players.find(x=>x.id===id);
  if(!p)return;
  const box=document.getElementById("player"+id);
  const info=box.querySelector(".last-rotation");
  if(p.active){ // sai
    p.lastRotation = (isSecondHalf?p.secondsP2:p.secondsP1) - p.rotationStart;
    info.textContent = "√öltima rota√ß√£o: "+formatTime(p.lastRotation);
  } else { // entra
    p.rotationStart = (isSecondHalf?p.secondsP2:p.secondsP1);
    info.textContent = "";
    p.rotations++;
  }
  p.active=!p.active;
  box.className=p.active?"player active":"player inactive";
  updatePlayersDisplay();
  autoSave();
}

function updatePlayersDisplay(){
  players.forEach(p=>{
    const box=document.getElementById("player"+p.id);
    const t=box.querySelector(".player-time");
    t.textContent=p.active?formatTime(p.secondsIn):formatTime(p.secondsOut);
  });
}

function calculateWorkload(p){return (p.secondsIn - p.secondsOut)/60;}
function updateSummary(){
  const tb=document.getElementById("summaryBody");tb.innerHTML="";
  const workloads=players.map(p=>calculateWorkload(p));
  const avg=workloads.reduce((a,b)=>a+b,0)/(workloads.length||1);
  players.forEach(p=>{
    const totalIn=p.secondsP1+p.secondsP2;const total=p.secondsIn+p.secondsOut;
    const perc=total>0?((p.secondsIn/total)*100).toFixed(1)+"%":"0%";
    const wl=calculateWorkload(p);const wlClass=wl>=avg?"workload-high":"workload-low";
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${p.name}</td>
      <td>${formatTime(p.secondsP1)}</td>
      <td>${formatTime(p.secondsP2)}</td>
      <td>${formatTime(totalIn)}</td>
      <td>${formatTime(p.secondsOut)}</td>
      <td>${p.rotations}</td>
      <td class="${wlClass}">${wl.toFixed(1)}</td>
      <td>${perc}</td>`;
    tb.appendChild(tr);
  });
}

function buildPlayerPanel(){
  const list=document.getElementById("playerList");list.innerHTML="";
  players.forEach(p=>{
    const inp=document.createElement("input");
    inp.value=p.name;
    inp.onchange=()=>{p.name=inp.value;document.querySelector("#player"+p.id+" .player-name").textContent=p.name;updateSummary();autoSave();};
    list.appendChild(inp);
  });
}

function togglePanel(open){const panel=document.getElementById("playerPanel");if(open){buildPlayerPanel();panel.classList.add("open");}else panel.classList.remove("open");}
document.getElementById("playersBtn").onclick=()=>togglePanel(true);
document.getElementById("closePanelBtn").onclick=()=>togglePanel(false);

document.getElementById("addBtn").onclick=()=>{
  playerCount++;const p={id:playerCount,name:"Jogador "+playerCount,active:false,secondsIn:0,secondsOut:0,secondsP1:0,secondsP2:0,rotations:0,lastRotation:0};
  players.push(p);
  const d=document.createElement("div");d.className="player inactive";d.id="player"+p.id;
  d.innerHTML=`<div class='player-name'>${p.name}</div><div class='player-time'>00:00</div><div class='last-rotation'></div>`;
  d.onclick=()=>togglePlayer(p.id);document.getElementById("players").appendChild(d);autoSave();
};
document.getElementById("removeBtn").onclick=()=>{
  if(players.length<=1)return;
  const p=players.pop();document.getElementById("player"+p.id)?.remove();autoSave();
};

function printSummary(){
  const teamA=document.getElementById("teamA").value||"Equipa A";
  const teamB=document.getElementById("teamB").value||"Equipa B";
  const table=document.querySelector(".summary").innerHTML;
  const w=window.open("","",`width=900,height=700`);
  w.document.write(`<html><head><title>Resumo</title>
  <style>body{font-family:Arial;background:#fff;color:#000;}
  table{width:100%;border-collapse:collapse;margin-top:20px;}
  th,td{border:1px solid #000;padding:6px;text-align:center;}th{background:#eee;}</style>
  </head><body><h2 style="text-align:center;">${teamA} vs ${teamB}</h2>${table}</body></html>`);
  w.document.close();w.print();
}

document.getElementById("printBtn").onclick=printSummary;
document.getElementById("fullscreenBtn").onclick=()=>{
  if(!document.fullscreenElement)document.documentElement.requestFullscreen();
  else document.exitFullscreen();
};

function autoSave(){
  localStorage.setItem("gameControlData",JSON.stringify({
    players,remaining,duration,isSecondHalf,playerCount,
    teamA:document.getElementById("teamA").value,
    teamB:document.getElementById("teamB").value
  }));
}
function restoreData(){
  const saved=localStorage.getItem("gameControlData");if(!saved)return;
  try{
    const d=JSON.parse(saved);
    duration=d.duration;remaining=d.remaining;isSecondHalf=d.isSecondHalf||false;playerCount=d.playerCount||14;players=d.players;
    document.getElementById("teamA").value=d.teamA||"";document.getElementById("teamB").value=d.teamB||"";
    const c=document.getElementById("players");c.innerHTML="";
    players.forEach(p=>{
      p.secondsP1=p.secondsP1||0;p.secondsP2=p.secondsP2||0;
      const div=document.createElement("div");
      div.id="player"+p.id;div.className=p.active?"player active":"player inactive";
      div.innerHTML=`<div class='player-name'>${p.name}</div><div class='player-time'>${p.active?formatTime(p.secondsIn):formatTime(p.secondsOut)}</div><div class='last-rotation'>${p.lastRotation? "√öltima rota√ß√£o: "+formatTime(p.lastRotation):""}</div>`;
      div.onclick=()=>togglePlayer(p.id);c.appendChild(div);
    });
  }catch(e){console.error("Erro ao restaurar",e);}
}
document.getElementById("startBtn").onclick=startTimer;
document.getElementById("pauseBtn").onclick=pauseTimer;
document.getElementById("intervalBtn").onclick=intervalTimer;
document.getElementById("resetBtn").onclick=resetTimer;
window.onload=()=>{restoreData();if(players.length===0)createPlayers(14);updateTimerDisplay();setInterval(()=>{updatePlayersDisplay();updateSummary();},1000);}
</script>
</body>
</html>
