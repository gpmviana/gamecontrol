<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Game Control</title>
<style>
:root {
  --bg-dark:#2c2c2c; --bg-light:#f4f4f4;
  --text-dark:#fff;  --text-light:#111;
  --green:#4caf50;   --red:#c0392b; --gray:#999;
}
*{box-sizing:border-box}
body{
  font-family:Arial, sans-serif;
  background:var(--bg-dark); color:var(--text-dark);
  margin:0; overflow-x:hidden;
  display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
  transition:background .3s,color .3s;
}
body.light{ background:var(--bg-light); color:var(--text-light); }

/* Barra superior */
.topbar{
  width:100%; background:#3b3b3b; color:#fff; padding:10px 20px;
  display:flex; align-items:center; justify-content:center; position:relative;
}
body.light .topbar{background:#ddd;color:#000}
.topbar h1{margin:0; font-size:24px; font-weight:bold; text-align:center}
.topbar .icons{position:absolute; right:20px; display:flex; gap:15px}
.topbar .icons button{background:none;border:none;color:inherit;font-size:22px;cursor:pointer}

/* Equipas */
.team-names{display:flex; justify-content:center; align-items:center; gap:10px; margin:10px 0 5px}
.team-names input{
  background:#222; color:#fff; border:1px solid #555; border-radius:6px;
  padding:5px 10px; font-size:16px; width:160px; text-align:center;
}
body.light .team-names input{background:#fff;color:#000;border:1px solid #aaa}
.team-names span{font-weight:bold; color:#ccc}

/* CronÃ³metro + controlos */
.timer{font-size:72px; margin:15px 0; font-weight:bold; text-align:center}
.controls{display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-bottom:20px; text-align:center}
.controls button{
  padding:10px 16px; font-size:15px; border:none; border-radius:6px; background:#555; color:#fff; cursor:pointer;
}
.controls button:hover{background:#666}
body.light .controls button{background:#ccc;color:#000}

/* Jogadores */
.players{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:15px;
  margin:10px auto;
  width:100%;
  max-width:1100px;
  justify-items:center;
}
.player{
  width:100%;
  border-radius:16px; padding:20px;
  text-align:center; color:#fff; cursor:pointer; transition:transform .2s;
}
.player:hover{transform:scale(1.04)}
.player.active{background:var(--green)}
.player.inactive{background:var(--red)}
.player strong{display:block; font-size:18px; margin-bottom:10px}
.player .time{font-size:36px; font-weight:bold}
.player .last{font-size:14px; color:var(--gray); margin-top:4px}

/* Resumo */
.summary{
  width:95%; max-width:1100px;
  background:#3b3b3b; color:#fff;
  border-radius:10px; padding:10px; margin:20px auto 40px;
}
body.light .summary{background:#eee;color:#000}
.summary table{width:100%; border-collapse:collapse; font-size:14px; text-align:center}
.summary th,.summary td{border:1px solid #666; padding:6px}
.work-pos{color:var(--green); font-weight:bold}
.work-neg{color:var(--red); font-weight:bold}

/* Painel lateral */
.sidepanel{
  position:fixed; top:0; right:-300px; width:300px; height:100%;
  background:#444; color:#fff; box-shadow:-3px 0 6px rgba(0,0,0,.3);
  transition:right .3s ease; padding:20px; z-index:1000;
}
body.light .sidepanel{background:#ddd;color:#000}
.sidepanel.open{right:0}
.sidepanel input{
  width:100%; margin-bottom:10px; border:none; border-radius:6px; padding:8px; font-size:15px;
}

/* Fullscreen */
.fullscreen-mode .topbar, .fullscreen-mode .team-names{display:none}
.fullscreen-mode .wrapper{
  width:100%; max-width:1100px;
  display:flex; flex-direction:column;
  align-items:center; justify-content:flex-start;
  min-height:100svh; margin:0 auto;
}
</style>
</head>
<body>
<div class="topbar">
  <h1>Game Control</h1>
  <div class="icons">
    <button id="printBtn">ðŸ“¸</button>
    <button id="themeToggle">ðŸŒ™</button>
    <button id="fullscreenBtn">â›¶</button>
  </div>
</div>

<div class="team-names">
  <input id="teamA" placeholder="Equipa" />
  <span>vs</span>
  <input id="opponent" placeholder="AdversÃ¡rio" />
</div>

<div class="wrapper">
  <div class="timer" id="timer">20:00</div>
  <div class="controls">
    <input type="number" id="setMinutes" value="20" min="1" style="width:60px;"> min
    <button id="startBtn">Iniciar</button>
    <button id="pauseBtn">Pausar</button>
    <button id="intervalBtn">Intervalo</button>
    <button id="resetBtn">Reset</button>
    <button id="addBtn">âž•</button>
    <button id="removeBtn">âž–</button>
    <button id="editPlayersBtn">ðŸ‘¥ Jogadores</button>
  </div>

  <div class="players" id="players"></div>

  <div class="summary">
    <h3 style="text-align:center;">Resumo do Jogo</h3>
    <table>
      <thead>
        <tr>
          <th>Jogador</th>
          <th>Tempo Campo</th>
          <th>Tempo Banco</th>
          <th>RotaÃ§Ãµes</th>
          <th>MÃ©dia RotaÃ§Ã£o</th>
          <th>% Jogo</th>
          <th>Workload</th>
        </tr>
      </thead>
      <tbody id="summaryBody"></tbody>
    </table>
  </div>
</div>

<!-- Painel lateral -->
<div class="sidepanel" id="sidepanel"></div>

<script>
let duration=20*60,remaining=duration,timerInterval,running=false,firstHalf=true,theme="dark",players=[];
const $=s=>document.querySelector(s);
function formatTime(sec){const s=Math.max(0,Math.abs(sec));const m=Math.floor(s/60),r=s%60;return`${String(m).padStart(2,"0")}:${String(r).padStart(2,"0")}`;}
function updateTimerDisplay(){$("#timer").textContent=formatTime(remaining);}
function tick(){remaining--;updateTimerDisplay();players.forEach(p=>{if(p.active){p.seconds++;if(firstHalf)p.part1++;else p.part2++;}else p.secondsOut++;});renderPlayers();renderSummary();autosave();}
function startTimer(){if(running)return;running=true;timerInterval=setInterval(tick,1000);}
function pauseTimer(){running=false;clearInterval(timerInterval);}
function resetTimer(){pauseTimer();duration=(parseInt($("#setMinutes").value)||20)*60;remaining=duration;players.forEach(p=>Object.assign(p,{active:false,seconds:0,secondsOut:0,part1:0,part2:0,rotations:0,lastRotation:0,startTime:0}));firstHalf=true;updateTimerDisplay();renderPlayers();renderSummary();autosave();}
function intervalTimer(){pauseTimer();firstHalf=false;remaining=(parseInt($("#setMinutes").value)||20)*60;updateTimerDisplay();autosave();}
function defaultPlayer(i){return{id:i,name:"Jogador "+i,active:false,seconds:0,secondsOut:0,part1:0,part2:0,rotations:0,lastRotation:0,startTime:0};}
function ensurePlayers(n){if(players.length===0){for(let i=1;i<=n;i++)players.push(defaultPlayer(i));return;}while(players.length<n)players.push(defaultPlayer(players.length+1));while(players.length>n)players.pop();}
function togglePlayer(id){const p=players.find(x=>x.id===id);if(!p)return;p.active=!p.active;if(p.active){p.startTime=Date.now();p.rotations++;}else p.lastRotation=Math.floor((Date.now()-(p.startTime||Date.now()))/1000);renderPlayers();renderSummary();autosave();}
function renderPlayers(){const c=$("#players");if(c.children.length!==players.length){c.innerHTML="";players.forEach(p=>{const d=document.createElement("div");d.id="player"+p.id;d.className="player "+(p.active?"active":"inactive");d.innerHTML=`<strong>${p.name}</strong><div class="time">${formatTime(p.active?p.seconds:p.secondsOut)}</div><div class="last">${!p.active&&p.lastRotation>0?"Ãšltima rotaÃ§Ã£o: "+formatTime(p.lastRotation):""}</div>`;d.onclick=()=>togglePlayer(p.id);c.appendChild(d);});}else players.forEach(p=>{const d=$("#player"+p.id);if(!d)return;d.className="player "+(p.active?"active":"inactive");d.querySelector("strong").textContent=p.name;d.querySelector(".time").textContent=p.active?formatTime(p.seconds):formatTime(p.secondsOut);d.querySelector(".last").textContent=!p.active&&p.lastRotation>0?"Ãšltima rotaÃ§Ã£o: "+formatTime(p.lastRotation):"";});}
function renderSummary(){const t=$("#summaryBody");t.innerHTML="";players.forEach(p=>{const total=p.part1+p.part2,avg=p.rotations>0?Math.floor(total/p.rotations):0,percent=((total/(duration*(firstHalf?1:2)))*100).toFixed(1),workload=p.seconds-p.secondsOut;const tr=document.createElement("tr");tr.innerHTML=`<td>${p.name}</td><td>${formatTime(p.seconds)}</td><td>${formatTime(p.secondsOut)}</td><td>${p.rotations}</td><td>${formatTime(avg)}</td><td>${percent}%</td><td class="${workload>=0?"work-pos":"work-neg"}">${workload>=0?"+":""}${(workload/60).toFixed(1)}m</td>`;t.appendChild(tr);});}
function buildSidePanel(){const p=$("#sidepanel");p.innerHTML="";players.forEach(pl=>{const i=document.createElement("input");i.value=pl.name;i.oninput=()=>{pl.name=i.value;renderPlayers();renderSummary();autosave();};p.appendChild(i);});}
function doPrint(){const h=`<h2 style="text-align:center;">${$("#teamA").value||"Equipa"} vs ${$("#opponent").value||"AdversÃ¡rio"}</h2>`;const tab=$(".summary").innerHTML;const w=window.open("","","width=900,height=700");w.document.write(`<html><head><title>Game Control</title></head><body>${h}${tab}</body></html>`);w.document.close();w.print();}
function setTheme(t){theme=t;document.body.classList.toggle("light",theme==="light");$("#themeToggle").textContent=theme==="light"?"ðŸŒž":"ðŸŒ™";}
function toggleTheme(){setTheme(theme==="light"?"dark":"light");autosave();}
let pseudoFull=false;async function toggleFull(){try{if(!document.fullscreenElement){await document.documentElement.requestFullscreen();}else{await document.exitFullscreen();}}catch(e){pseudoFull=!pseudoFull;document.body.classList.toggle("fullscreen-mode",pseudoFull);}}
function dataKey(){return"gameControlData_vFinal";}
function autosave(){localStorage.setItem(dataKey(),JSON.stringify({teamA:$("#teamA").value,opponent:$("#opponent").value,duration,remaining,firstHalf,theme,players}));}
function load(){const r=localStorage.getItem(dataKey());if(r){const d=JSON.parse(r);$("#teamA").value=d.teamA||"";$("#opponent").value=d.opponent||"";duration=d.duration||duration;remaining=typeof d.remaining==="number"?d.remaining:duration;firstHalf=typeof d.firstHalf==="boolean"?d.firstHalf:true;setTheme(d.theme||"dark");players=Array.isArray(d.players)?d.players:[];}ensurePlayers(players.length||12);renderPlayers();renderSummary();buildSidePanel();updateTimerDisplay();}
$("#startBtn").onclick=startTimer;$("#pauseBtn").onclick=pauseTimer;$("#resetBtn").onclick=resetTimer;$("#intervalBtn").onclick=intervalTimer;$("#printBtn").onclick=doPrint;$("#themeToggle").onclick=toggleTheme;$("#fullscreenBtn").onclick=toggleFull;$("#addBtn").onclick=()=>{ensurePlayers(players.length+1);renderPlayers();renderSummary();buildSidePanel();autosave();};$("#removeBtn").onclick=()=>{if(players.length>1){ensurePlayers(players.length-1);renderPlayers();renderSummary();buildSidePanel();autosave();}};$("#editPlayersBtn").onclick=()=>$("#sidepanel").classList.toggle("open");$("#teamA").oninput=autosave;$("#opponent").oninput=autosave;setInterval(()=>{if(running)autosave();},3000);load();
</script>
</body>
</html>
